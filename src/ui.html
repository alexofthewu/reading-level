<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Reading Level Checker</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 16px; }
    button { margin-top: 10px; }
  </style>
</head>
<body>
  <h3>Reading Level Checker</h3>
  <label>Target Grade Level:
    <input type="number" id="targetGrade" value="5" min="1" max="12" />
  </label>
  <button id="checkBtn">Check</button>
  <div id="results"></div>

  <script>
    document.getElementById('checkBtn').onclick = () => {
      const targetGrade = parseInt(document.getElementById('targetGrade').value, 10);
      parent.postMessage({ 
        pluginMessage: { 
          type: 'analyze-text',  // Changed to match code.js message type
          targetGrade 
        }
      }, '*');
    };

    window.onmessage = (event) => {
      const message = event.data.pluginMessage;
      if (message.type === 'analysis-results') {  // Changed to match code.js response type
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '';
        
        message.results.forEach(result => {
          const p = document.createElement('p');
          const text = result.text.length > 30 ? 
            result.text.slice(0, 30) + '...' : 
            result.text;
          
          p.textContent = `Text: "${text}" - Grade Level: ${result.readingLevel.toFixed(1)}`;
          if (result.readingLevel > message.targetGrade) {
            p.style.color = 'red';
          }
          resultsDiv.appendChild(p);
        });
      }
    };
  </script>
</body>
</html>